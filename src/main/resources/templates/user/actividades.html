<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Mis Actividades</title>

	<!-- Bootstrap & FontAwesome -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

	<style>
		.pagination .page-link {
			cursor: pointer;
		}
	</style>
</head>

<body class="bg-light" style="font-family: 'Montserrat', sans-serif;">

	<div th:replace="menu :: navbar"></div>

	<section class="container text-center my-5">
		<h2 class="fw-bold text-primary mb-3">Historial de Actividades</h2>
		<p class="lead text-muted">Consulta tus compras o interacciones con libros</p>
	</section>

	<section class="container mb-5">
		<div class="card shadow-lg border-0 rounded">
			<div class="card-body p-4">

				<table id="tablaActividades" class="table table-hover align-middle" th:if="${not #lists.isEmpty(actividades)}">
					<thead class="table-primary">
						<tr>
							<th scope="col">#</th>
							<th scope="col"><i class="fa-regular fa-calendar-days me-1"></i>Fecha Acción</th>
							<th scope="col"><i class="fa-solid fa-book me-1"></i>Libro</th>
							<th scope="col"><i class="fa-solid fa-clipboard-list me-1"></i>Descripción</th>
							<th scope="col"><i class="fa-solid fa-tags me-1"></i>Precio (S/)</th>
						</tr>
					</thead>

					<tbody>
						<tr th:each="actividad, iter : ${actividades}" class="actividad-row">
							<td th:text="${iter.count}" class="fw-semibold text-secondary"></td>
							<td th:text="${#dates.format(actividad.fecha, 'dd/MM/yyyy HH:mm')}"></td>
							<td>
								<span th:text="${actividad.libro != null ? actividad.libro.titulo : 'N/A'}" class="fw-semibold"></span><br />
								<small class="text-muted" th:text="${actividad.libro != null ? actividad.libro.autor : ''}"></small>
							</td>
							<td th:text="${actividad.descripcion}"></td>
							<td th:text="${actividad.libro != null ? actividad.libro.precio : '0.00'}" class="text-success fw-semibold"></td>
						</tr>
					</tbody>

					<tfoot class="table-light">
						<tr>
							<th colspan="4" class="text-end fw-bold text-primary">Total Gastado:</th>
							<th class="fw-semibold text-success" th:text="'S/ ' + ${totalPrecio}">S/ 0.00</th>
						</tr>
					</tfoot>
				</table>

				<!-- Paginación -->
				<nav th:if="${not #lists.isEmpty(actividades)}">
					<ul id="pagination" class="pagination justify-content-center mt-3"></ul>
				</nav>

				<!-- Si no hay actividades -->
				<div th:if="${#lists.isEmpty(actividades)}" class="alert alert-info text-center shadow-sm mt-3 mb-0">
					<i class="fas fa-info-circle me-2"></i>
					Aún no tienes actividades registradas.
				</div>

			</div>
		</div>
	</section>


	<section class="text-center position-relative">
		<div class="d-flex flex-column justify-content-center align-items-center text-white py-5 position-relative"
			style="background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('/img/Libreria_magica.gif'); 
				   background-size: cover; 
				   background-position: center; 
				   min-height: 250px;">
			<h3 class="fw-bold mb-3">¿Quieres seguir explorando?</h3>
			<a href="/user/catalogo" class="btn btn-light btn-lg shadow">
				Ir al catálogo <i class="fas fa-arrow-right ms-2"></i>
			</a>
		</div>
	</section>

	<!-- Footer -->
	<div th:replace="footer :: footer"></div>

	<!-- Scripts -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const rows = document.querySelectorAll(".actividad-row");
			const itemsPerPage = 10;
			const pagination = document.getElementById("pagination");
			let currentPage = 1;

			function showPage(page) {
				const start = (page - 1) * itemsPerPage;
				const end = start + itemsPerPage;
				rows.forEach((row, i) => {
					row.style.display = (i >= start && i < end) ? "table-row" : "none";
				});
			}

			function setupPagination() {
				const pageCount = Math.ceil(rows.length / itemsPerPage);
				pagination.innerHTML = "";
				for (let i = 1; i <= pageCount; i++) {
					const li = document.createElement("li");
					li.className = "page-item" + (i === currentPage ? " active" : "");
					li.innerHTML = `<a class="page-link">${i}</a>`;
					li.addEventListener("click", () => {
						currentPage = i;
						showPage(currentPage);
						setupPagination();
					});
					pagination.appendChild(li);
				}
			}

			if (rows.length > 0) {
				showPage(currentPage);
				setupPagination();
			}
		});
	</script>
</body>
</html>
