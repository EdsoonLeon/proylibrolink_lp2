<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Registrar Compra</title>

	<!-- Bootstrap & FontAwesome -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

</head>

<body class="bg-light" style="font-family: 'Montserrat', sans-serif;">

	<div th:replace="menu :: navbar"></div>

	<section class="container text-center my-5">
		<h2 class="fw-bold text-primary mb-3">Registrar Compra</h2>
		<p class="lead text-muted">Selecciona un libro disponible para realizar tu compra</p>
	</section>

	<section class="container mb-5">
		<div class="card border-0 shadow-lg rounded-4">
			<div class="card-body p-4">

				<div th:if="${mensaje}" class="alert alert-success text-center mb-4" th:text="${mensaje}"></div>

				<div class="table-responsive">
					<table class="table table-hover align-middle text-center">
						<thead class="table-primary">
							<tr>
								<th><i class="fa-solid fa-image me-2"></i> Imagen</th>
								<th><i class="fa-solid fa-book me-2"></i> Título</th>
								<th><i class="fa-solid fa-user me-2"></i> Autor</th>
								<th><i class="fa-solid fa-layer-group me-2"></i> Categoría</th>
								<th><i class="fa-solid fa-box-open me-2"></i> Stock</th>
								<th><i class="fa-solid fa-hand-holding-book me-2"></i> Acción</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="libro : ${libros}">
								<td style="width: 100px;">
									<img th:src="@{/img/{imagen}(imagen=${libro.imagen})}" alt="Imagen" class="img-thumbnail shadow-sm"
										style="height: 80px; object-fit: cover;">
								</td>
								<td class="fw-semibold" th:text="${libro.titulo}"></td>
								<td th:text="${libro.autor}"></td>
								<td th:text="${libro.categoria.nombre}"></td>
								<td>
									<span th:if="${libro.stock > 0}" class="text-success fw-bold"
										th:text="${libro.stock}"></span>
									<span th:if="${libro.stock == 0}" class="text-danger fw-bold">Agotado</span>
								</td>
								<td>
									<!-- Si hay stock -->
									<form th:if="${libro.stock > 0}" th:action="@{/user/prestamo}" method="post"
										class="d-inline">
										<input type="hidden" name="libroId" th:value="${libro.id}" />
										<button type="submit" class="btn btn-sm btn-outline-primary shadow-sm">
											<i class="fa-solid fa-hand-pointer me-1"></i> Comprar
										</button>
									</form>
									<!-- Si está agotado -->
									<button th:if="${libro.stock == 0}" class="btn btn-sm btn-secondary" disabled>
										<i class="fa-solid fa-ban me-1"></i> Agotado
									</button>
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div th:if="${#lists.isEmpty(libros)}" class="alert alert-warning text-center mt-4 shadow-sm">
					<i class="fas fa-exclamation-circle me-2"></i>
					No hay libros disponibles para comprar este momento.
				</div>

			</div>
		</div>
	</section>

	<section class="text-center position-relative">
		<div class="d-flex flex-column justify-content-center align-items-center text-white py-5 position-relative"
			style="background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('/img/Libreria_magica.gif'); 
				   background-size: cover; 
				   background-position: center; 
				   min-height: 250px;">
			<h3 class="fw-bold mb-3">¿Quieres explorar más libros?</h3>
			<a href="/user/catalogo" class="btn btn-light btn-lg shadow">
				Ir al catálogo <i class="fas fa-arrow-right ms-2"></i>
			</a>
		</div>
	</section>

	<!-- Footer -->
	<div th:replace="footer :: footer"></div>

	<!-- Bootstrap & SweetAlert -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<script th:inline="javascript">
		/*<![CDATA[*/
		const mensaje = /*[[${mensaje}]]*/ null;
		if (mensaje) {
			Swal.fire({
				icon: 'success',
				title: '¡Compra registrada!',
				text: mensaje,
				showConfirmButton: false,
				timer: 3000,
				timerProgressBar: true
			});
		}
		/*]]>*/
	</script>

</body>

</html>